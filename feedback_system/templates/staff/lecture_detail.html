{% extends 'base_layout.html' %}
{% load i18n %}

{% block title %}{% trans "Lecture Feedback Detail" %}{% endblock %}

{% block content %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark d-flex justify-content-between">
  <span class="navbar-brand h2 mb-0">{% trans "Lecture Feedback System" %} <small>{% if user.is_authenticated %}{{user.get_full_name}} ({{user.email}}){% endif %}</small></span>
  <div>
    <ul class="navbar-nav mr-auto d-flex flex-row">
      <li class="nav-item">
        <a class="nav-link border-right border-white p-3" href="{% url 'staff:index' %}" role="button">{% trans "Lecture History" %}</a>
      </li>
      <li class="nav-item">
        <a class="nav-link border-left border-white p-3" href="{% url 'staff:logout' %}" role="button">{% trans "Logout" %}</a>
      </li>
    </ul>
  </div>
</nav>


<script>
  //save the panels user has open
  function savePanels() {
    var hiddenPanels = [];
    $(".remember_visibility").each(function(index){
      if($(this).is(':hidden')){
        hiddenPanels.push("#" + $(this).attr('id'));
      }
    });
    localStorage.setItem("hiddenPanelList", JSON.stringify(hiddenPanels));
  }


  $(document).ready(function(){
    //hide the panels the user previously had hidden
    var hiddenPanels = JSON.parse(localStorage.getItem("hiddenPanelList"));
    if(hiddenPanels!=null && hiddenPanels!=undefined){
      for(i=0; i<hiddenPanels.length; i++) {
        $(hiddenPanels[i]).hide();
      }
    }

    $("#toggleDetailBtn").click(function(){
      $("#detailDiv1").toggle("fast");
      $("#detailDiv2").toggle("fast");
      savePanels();
    });

    $("#toggleSessionBtn").click(function(){
      $("#sessionDiv").toggle("medium");
      savePanels();
    });

    $("#toggleQuestionBtn").click(function(){
      $("#questionDiv").toggle("fast");
      savePanels();
    });

    $("#toggleGraphBtn").click(function(){
      $("#feedbackDiv").toggle("fast");
      savePanels();
    });
  });

</script>

<div class="container-fluid bg-light pb-3">
  <div class="row">
    <div class="col-sm-auto bg-dark d-flex flex-row p-3 rounded-bottom-right">
      <button class="btn mx-1" type="button" id="toggleDetailBtn">Toggle Detail</button>
      <button class="btn mx-1" type="button" id="toggleSessionBtn">Toggle Sessions</button>
      <button class="btn mx-1" type="button" id="toggleQuestionBtn">Toggle Questions</button>
      <button class="btn mx-1" type="button" id="toggleGraphBtn">Toggle Graphs</button>
    </div>
  </div>
  <div class="row my-4 d-flex justify-content-center">
    <div class="col-sm-6">
      <hr />
      <div class="d-flex justify-content-between">
        <div>
          <h2>{% trans "Session Code" %}: {{ lecture.session_code }}</h2>
          <h4>{% trans "Session Running" %}: {{ lecture.is_running }}</h4>
          <h4>{% trans "Questions Enabled" %}: {{ lecture.is_taking_questions }}</h4>
        </div>
        <div>
          <a href="{% url 'staff:lecture_start_feedback_session' lecture.id %}" role="button" class="btn btn-lg btn-outline-success m-2">Run Session</a>
          <a href="{% url 'staff:lecture_stop_feedback_session' lecture.id %}" role="button" class="btn btn-lg btn-outline-danger m-2">Stop Session</a>
          <a href="" role="button" class="btn btn-lg btn-outline-primary m-2">Toggle Overlay</a>
          <br />
          <a href="{% url 'staff:lecture_toggle_questions' lecture.id %}" role="button" class="btn btn-lg btn-outline-secondary m-2">{% if lecture.is_taking_questions %}{% trans "Disable" %}{% else %}{% trans "Enable" %}{% endif %} {% trans "Questions" %}</a>
          <a href="{% url 'staff:lecture_generate_session_code' lecture.id %}" role="button" class="btn btn-lg btn-outline-secondary m-2">{% trans "Generate New Session Code" %}</a>
        </div>
      </div>
    </div>
      <div class="col-sm-3 remember_visibility" id="detailDiv1">
        <form>
          <div class="form-group">
            <label for="exampleFormControl1">{% trans "Lecture Title" %}</label>
            <input class="form-control" id="exampleFormControl1" type="text" placeholder="{{lecture.title}}" readonly>
            <label for="exampleFormControl2">{% trans "Lecture Author" %}</label>
            <input class="form-control" id="exampleFormControl2" type="text" placeholder="{{user.get_full_name}} {{user.email}}" readonly>
            <label for="exampleFormControl3">{% trans "No. Slides" %}</label>
            <input class="form-control" id="exampleFormControl3" type="text" placeholder="{{lecture.slide_count}}" readonly>
          </div>
        </form>
      </div>
      <div class="col-sm-3 remember_visibility" id="detailDiv2">
        <div class="form-group">
          <label for="exampleFormControl8">{% trans "First Started" %}</label>
          <input class="form-control" id="exampleFormControl8" type="text" placeholder="{{lecture.getFirstStarted_datetime}}" readonly>
          <label for="exampleFormControl7">{% trans "Last Ended" %}</label>
          <input class="form-control" id="exampleFormControl7" type="text" placeholder="{{lecture.getLastEnded_datetime}}" readonly>
          <label for="exampleFormControl6">{% trans "Total Runtime" %}</label>
          <input class="form-control" id="exampleFormControl6" type="text" placeholder="{{lecture.getTotalRuntime}}" readonly>
        </div>
      </div>
  </div>
  <div class="row my-4  d-flex justify-content-center">
    <div class="col-sm-6 remember_visibility" id="sessionDiv">
      <center>
        <h3>{% trans "Feedback Sessions" %}</h3>
      </center>
      <hr class="mt-0" />
      <table class="table table-bordered">
        <thead class="thead-dark">
          <tr>
            <th scope="col">{% trans "Section" %}</th>
            <th scope="col">{% trans "Startime" %}</th>
            <th scope="col">{% trans "Endtime" %}</th>
            <th scope="col">{% trans "Runtime" %}</th>
          </tr>
        </thead>
        {% if sessions %}
          <tbody>
            {% for session in sessions %}
              <tr>
                <th>{{ forloop.counter }}</th>
                <td>{{ session.start_time }}</td>
                <td>{{ session.end_time }}</td>
                <td>{{ session.getRuntime_timestr }}</td>
              </tr>
            {% endfor %}
          </tbody>
        {% endif %}
      </table>
    </div>
    <div class="col-sm-6 remember_visibility" id="questionDiv">
      <center>
        <h3>{% trans "Current Questions" %}</h3>
      </center>
      <hr class="mt-0" />
      {% if questions %}
        <ul class="list-group list-group-flush">
          {% for question in questions %}
            <li class="list-group-item d-flex justify-content-between align-items-center">{{ question.question_text }}<a href="{% url 'staff:question_mark_reviewed' question.id %}" role="button" class="btn btn-success ml-1">{% trans "Mark Reviewed" %}</a></li>
          {% endfor %}
        </ul>
      {% else %}
        <center>
          <h4>{% trans "No Questions for this Session" %}</h4>
        </center>
      {% endif %}
    </div>
  </div>
  <div id="feedbackDiv" class="row my-4 d-flex justify-content-center remember_visibility">
    <div class="col-sm-auto">
      <canvas id="canvas1" class="border border-dark  m-1"></canvas>
    </div>
    <div class="col-sm-auto">
      <canvas id="canvas2" class="border border-dark  m-1"></canvas>
    </div>
    <div class="col-sm-auto">
      <canvas id="canvas3" class="border border-dark  m-1"></canvas>
    </div>
    <div class="col-sm-auto">
      <canvas id="canvas4" class="border border-dark  m-1"></canvas>
    </div>
    <div class="col-sm-auto">
      <canvas id="canvas5" class="border border-dark  m-1"></canvas>
    </div>
  </div>
</div>
</div>

<script>
  for (var i = 1; i < 6; i++) {
    var canvas = document.getElementById("canvas" + i.toString());
    var ctx = canvas.getContext("2d");
    ctx.font = "35px Arial";
    ctx.fillText("JS Canvas Graph", 10, 50);
  }
</script>
{% endblock %}
